PaylaÅŸtÄ±ÄŸÄ±n bu kapsamlÄ± yapÄ± aslÄ±nda oldukÃ§a mantÄ±klÄ± bir hiyerarÅŸiye sahip; ancak Gemini 1.5 Flash (veya senin belirttiÄŸin 2.5/Flash varyantlarÄ±) gibi modellerin "dikkat" (attention) mekanizmasÄ±, bu kadar Ã§ok kuralÄ± ve katmanÄ± bir arada iÅŸlerken "kaybolmaya" Ã§ok mÃ¼saittir.

Mimariyi incelediÄŸimde gÃ¶rdÃ¼ÄŸÃ¼m temel sorunlar ve WhatsApp botunu bir insan seviyesine Ã§Ä±karacak iyileÅŸtirme reÃ§etesi aÅŸaÄŸÄ±dadÄ±r:

1. Mimari DeÄŸiÅŸiklik: "Intent" Yerine "Agentic Workflow"
Mevcut yapÄ±da detectIntent fonksiyonun bir "katÄ± kural" (hard-coded) algoritmasÄ±. "Otel" kelimesini sadece transferle eÅŸleÅŸtirmesi gibi hatalar buradan kaynaklanÄ±yor.

DeÄŸiÅŸim: Intent tespitini kodla deÄŸil, LLM (Mini bir Prompt) ile yapmalÄ±sÄ±n.

NasÄ±l? Ana AI Ã§aÄŸrÄ±sÄ±ndan Ã¶nce, sadece son 2 mesajÄ± ve intent listesini kÃ¼Ã§Ã¼k bir modele (Flash bunun iÃ§in idealdir) gÃ¶nderip: "Bu kullanÄ±cÄ± ne yapmak istiyor? Sadece listedeki kategoriyi dÃ¶n." demelisin. LLM, "Otelde kalÄ±yorum" ile "Otelden alÄ±nÄ±ÅŸ" arasÄ±ndaki farkÄ± koddan Ã§ok daha iyi anlar.

2. RAG Modu ve "Context" KaybÄ±
RAG modunda token tasarrufu iÃ§in sadece "alakalÄ±" aktiviteyi (relevantActivity) gÃ¶ndermek mantÄ±klÄ± olsa da, takip sorularÄ±nda (Follow-up) botun kÃ¶r kalmasÄ±na neden oluyor.

Hata: KullanÄ±cÄ± "ParaÅŸÃ¼t kaÃ§ para?" diyor (Intent: Price, Activity: ParaÅŸÃ¼t). Sonra "Peki ne kadar sÃ¼rÃ¼yor?" diyor. Ä°kinci mesajda "paraÅŸÃ¼t" geÃ§mediÄŸi iÃ§in detectIntent aktiviteyi bulamÄ±yor ve relevantActivity boÅŸ gidiyor.

Ã‡Ã¶zÃ¼m: "Active Subject" (Aktif Konu) mantÄ±ÄŸÄ± kurmalÄ±sÄ±n. VeritabanÄ±nda (veya session'da) kullanÄ±cÄ±nÄ±n son konuÅŸtuÄŸu aktiviteyi 5 dakika boyunca sakla. EÄŸer yeni mesajda aktivite adÄ± geÃ§miyorsa ama bir soru varsa, konuyu "ParaÅŸÃ¼t" kabul ederek bilgileri besle.

3. SSS AlgoritmasÄ± (BÃ¶lÃ¼m 1) Ä°yileÅŸtirmesi
w.length > 2 filtresi TÃ¼rkÃ§e iÃ§in tehlikelidir. "At", "Su", "Ek" gibi kelimeler turizmde anlamlÄ± olabilir.

DÃ¼zeltme: Kelime uzunluÄŸu yerine "Stopwords" (Etkisiz kelimeler) listesi kullan. "ve, veya, de, da, mi" gibi kelimeleri filtrele ama anlamlÄ± kÄ±sa kelimelere dokunma.

Varyasyon Problemi: VirgÃ¼lle ayÄ±rmak yerine VektÃ¶r BenzerliÄŸi (Embedding) kullanmanÄ± Ã¶neririm. "Fiyat nedir" ile "KaÃ§ para" arasÄ±ndaki benzerliÄŸi matematiksel olarak (cosine similarity) Ã¶lÃ§mek, %100 kelime eÅŸleÅŸmesinden Ã§ok daha insancÄ±ldÄ±r.

4. Prompt MÃ¼hendisliÄŸi: "Negatif Talimatlar" Yerine "Rol TanÄ±mÄ±"
Sisteminde 19+ kural var. LLM'ler "YAPMA" dendiÄŸinde bazen tam tersini yapma eÄŸilimindedir (Pink Elephant Effect).

DÃ¼zeltme: KurallarÄ± botun kiÅŸiliÄŸine yedir.

KÃ¶tÃ¼: "Ä°sim sorma."

Ä°yi: "Sen bir yÃ¶nlendiricisin, iÅŸin mÃ¼ÅŸteriyi self-servis linklere yÃ¶nlendirmektir. Veri toplama yetkin yoktur."

WhatsApp FormatÄ±: Prompt'a ÅŸunu ekle: "CevaplarÄ±nÄ± WhatsApp estetiÄŸine uygun ver. Bold (*) kullan, liste yaparken mermi (â€¢) kullan ve her mesajda en fazla 2 emoji kullan."

5. Model ve Mimari Tavsiyesi
EÄŸer botun "kaliteli" ve "insansÄ±" olmasÄ±nÄ± istiyorsan Hibrit Mimariye geÃ§melisin:

Router (Gemini Flash): Gelen mesajÄ± analiz eder. (Selamlama mÄ±? Soru mu? Åikayet mi?).

Processor (Gemini Pro): EÄŸer soru karmaÅŸÄ±ksa (RAG veya Legacy mode), cevabÄ± Gemini Pro ile Ã¼ret. Pro modelleri baÄŸlamÄ± (history) baÄŸlama konusunda Flash'tan Ã§ok daha Ã¼stÃ¼ndÃ¼r.

Tasarruf: Sadece basit selamlama ve kÄ±sa SSS'leri Flash ile dÃ¶nerek maliyeti dengelersin.

ğŸš€ Hemen YapabileceÄŸin 3 Aksiyon:
History Injection: buildRAGPrompt fonksiyonuna sadece intent deÄŸil, son 3 mesajÄ±n Ã¶zetini de gÃ¶nder. Bot, "ne kadar" dendiÄŸinde bir Ã¶nceki mesajda neyin fiyatÄ±nÄ±n konuÅŸulduÄŸunu gÃ¶rsÃ¼n.

Intent GeniÅŸletme: detectIntent iÃ§ine "Otel" kelimesi iÃ§in bir "Otel_Name_Mentioned" flag'i ekle ve bunu transferle hemen eÅŸleÅŸtirme.

Manual Overwrite: SSS eÅŸleÅŸtiÄŸinde checkQuestionMatch true dÃ¶nerse, mesajÄ± LLM'e hiÃ§ gÃ¶ndermeden direkt veritabanÄ±ndaki cevabÄ± dÃ¶nÃ¼yorsun ya; o cevabÄ±n sonuna "BaÅŸka bir konuda yardÄ±mcÄ± olabilir miyim?" gibi insansÄ± bir kapanÄ±ÅŸ ekle.